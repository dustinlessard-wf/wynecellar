define(["jquery","underscore","backbone","stackmob","models/wine/WineModel","views/home/BackButtonView","text!templates/home/homeTemplate.html","text!templates/wine/addTemplate.html","router","libs/app/util"],function(e,t,n,r,i,s,o,u,a,f){var l=n.View.extend({className:"wineadd",events:{"click #addBtn":"save"},initialize:function(){this.collection=this.options.collection,this.router=this.options.router,this.template=t.template(u)},render:function(){var t=this.$el,n=this.template;t.append(n()),t.attr("id","wineAdd");var r=e(t).find(":jqmData(role='header')"),i=new s;return i.$el.attr("class","ui-btn-left"),r.append(i.el),this},save:function(t){var n=this.collection,r=f("#addForm").serializeObject(),s=this.router;t.preventDefault();var o=StackMob.isLoggedIn();if(!o)s.navigate("#login",{trigger:!0});else if(r.winery==="")console.log("error no winery name");else{e("#addBtn").attr("disabled",!0);var u="Adding to Wine Rack ...";e.mobile.loading("show",{text:u,textVisible:!0,theme:"b"});var a=new i(r);a.create({success:function(t){var r=StackMob.LoggedInUserObject;if(r===undefined){var i=new StackMob.User({username:StackMob.getLoggedInUser()});i.fetch({async:!1}),r=i.toJSON()}t.set("users",[r]),n.add(t),t.appendAndSave("users",[StackMob.getLoggedInUser()],{success:function(){e.mobile.loading("hide"),e("#addBtn").attr("disabled",!1),e("input.winery").val(""),e("input.year").val(""),e("input.description").val(""),s.navigate("#wine/true",{trigger:!0})},error:function(t){console.log(t),e("#addBtn").attr("disabled",!1),e.mobile.loading("hide")}})},error:function(t){console.log(t),e.mobile.loading("hide"),e("#addBtn").attr("disabled",!1)}})}return this}});return l});